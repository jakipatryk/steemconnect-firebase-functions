



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>Authentication with Angular - steemconnect-firebase-functions</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#what-will-you-learn" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="steemconnect-firebase-functions" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                steemconnect-firebase-functions
              </span>
              <span class="md-header-nav__topic">
                Authentication with Angular
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/jakipatryk/steemconnect-firebase-functions/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      jakipatryk/steemconnect-firebase-functions
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    steemconnect-firebase-functions
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/jakipatryk/steemconnect-firebase-functions/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      jakipatryk/steemconnect-firebase-functions
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Authentication with Angular
      </label>
    
    <a href="./" title="Authentication with Angular" class="md-nav__link md-nav__link--active">
      Authentication with Angular
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-will-you-learn" title="What will you learn?" class="md-nav__link">
    What will you learn?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#difficulty" title="Difficulty" class="md-nav__link">
    Difficulty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-firebase" title="What is Firebase?" class="md-nav__link">
    What is Firebase?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-oauth2" title="What is OAuth2?" class="md-nav__link">
    What is OAuth2?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorization-code-grant" title="Authorization Code Grant" class="md-nav__link">
    Authorization Code Grant
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-firebase-project" title="Creating Firebase project" class="md-nav__link">
    Creating Firebase project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-steemconnect-project" title="Creating SteemConnect project" class="md-nav__link">
    Creating SteemConnect project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-angular-project" title="Creating Angular project" class="md-nav__link">
    Creating Angular project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend" title="Backend" class="md-nav__link">
    Backend
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" title="Imports" class="md-nav__link">
    Imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" title="Functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-function" title="Helper function" class="md-nav__link">
    Helper function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-functions-locally" title="Running functions locally" class="md-nav__link">
    Running functions locally
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend" title="Frontend" class="md-nav__link">
    Frontend
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messages" title="Messages" class="md-nav__link">
    Messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend-once-again-security" title="Backend once again (security)" class="md-nav__link">
    Backend once again (security)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-the-app-and-cloud-functions" title="Deploying the app and Cloud Functions" class="md-nav__link">
    Deploying the app and Cloud Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../broadcasting/" title="Broadcasting" class="md-nav__link">
      Broadcasting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firebase/" title="Firebase" class="md-nav__link">
      Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../oauth2/" title="OAuth2" class="md-nav__link">
      OAuth2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../operation-creators/" title="Operation Creators" class="md-nav__link">
      Operation Creators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../shared/" title="Shared" class="md-nav__link">
      Shared
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-will-you-learn" title="What will you learn?" class="md-nav__link">
    What will you learn?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#difficulty" title="Difficulty" class="md-nav__link">
    Difficulty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-firebase" title="What is Firebase?" class="md-nav__link">
    What is Firebase?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-oauth2" title="What is OAuth2?" class="md-nav__link">
    What is OAuth2?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorization-code-grant" title="Authorization Code Grant" class="md-nav__link">
    Authorization Code Grant
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-firebase-project" title="Creating Firebase project" class="md-nav__link">
    Creating Firebase project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-steemconnect-project" title="Creating SteemConnect project" class="md-nav__link">
    Creating SteemConnect project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-angular-project" title="Creating Angular project" class="md-nav__link">
    Creating Angular project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend" title="Backend" class="md-nav__link">
    Backend
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" title="Imports" class="md-nav__link">
    Imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" title="Functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-function" title="Helper function" class="md-nav__link">
    Helper function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-functions-locally" title="Running functions locally" class="md-nav__link">
    Running functions locally
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend" title="Frontend" class="md-nav__link">
    Frontend
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messages" title="Messages" class="md-nav__link">
    Messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend-once-again-security" title="Backend once again (security)" class="md-nav__link">
    Backend once again (security)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-the-app-and-cloud-functions" title="Deploying the app and Cloud Functions" class="md-nav__link">
    Deploying the app and Cloud Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jakipatryk/steemconnect-firebase-functions/edit/master/docs/authentication.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Authentication with Angular</h1>
                
                <h4 id="what-will-you-learn">What will you learn?</h4>
<ul>
<li>how OAuth2 authorization code grant works</li>
<li>how to use <a href="https://github.com/jakipatryk/steemconnect-firebase-functions">steemconnect-firebase-functions</a> library to set up user authentication via SteemConnect in the Firebase Cloud Functions</li>
<li>how to build simple frontend with Angular and AngularFire2 to complete OAuth2 code flow and make operations on the Firebase Cloud Firestore database</li>
</ul>
<h4 id="requirements">Requirements</h4>
<ul>
<li>TypeScript knowledge</li>
<li>some experience with Angular</li>
<li><a href="https://github.com/angular/angular-cli#installation">Angular CLI</a> installed</li>
</ul>
<h4 id="difficulty">Difficulty</h4>
<ul>
<li>basic</li>
</ul>
<h2 id="what-is-firebase">What is Firebase?</h2>
<p>Firebase is a platform which <strong>gives you the ability to create applications</strong> that use database or authentication <strong>without writing any backend code</strong>...</p>
<p>Well, this is true as long as we don't want to implement an auth system based on SteemConnect :) Firebase Authentication comes with a few auth providers built-in, such as Facebook or Twitter, but <strong>if we want to use SteemConnect we will have to write some backend code</strong>.</p>
<p>The backend code runs on the <strong>Cloud Functions</strong> triggerable by events such as <strong>HTTP requests</strong>.</p>
<p><strong>Important note</strong>: if you want to use Firebase on production (it's about deploying Cloud Functions), you will have to choose a paid pricing plan. Why? Our <strong>Cloud Functions are going to make requests to external API</strong> (SteemConnect) and <strong>this kind of operations are not included in the free</strong> (Spark) <strong>plan</strong>. Fortunately, <strong>we still can run Functions locally</strong>, so to follow this tutorial you won't have to pay anything. For more information check <a href="https://firebase.google.com/pricing/">pricing</a>.</p>
<h2 id="what-is-oauth2">What is OAuth2?</h2>
<p>Have you ever signed into any app using your <strong>external account</strong>, maybe the one you have on Google or Facebook? You click 'Login with Facebook' and then the popup window is being opened. You see Facebook which asks you if you want to give this third-party app access to the listed resources. You probably accept it and then magically you become logged in to the app.</p>
<p>You are the <strong>resource owner</strong>, you operate via <strong>user-agent</strong> (in this case a browser) and the application that wants you to give it an access to resources is the <strong>client</strong>.</p>
<p>This process is possible thanks to <strong>OAuth2</strong> - an authorization framework which enables third-party applications to get limited access to the service.</p>
<p>It's all about the <strong>access tokens</strong>. These strings are used to access resources protected by the service and the entire <strong>OAuth2 flow</strong> is oriented on getting them. The protected resource can be almost anything, from user data to ability to broadcast operations such as publishing a post.</p>
<p>Even though there are a few OAuth2 flows, all of them are similar due to the fact that access token is the end goal.</p>
<h3 id="authorization-code-grant">Authorization Code Grant</h3>
<p>The type of OAuth2 flow we will use in this tutorial is authorization code grant. This flow is split into two parts:</p>
<ul>
<li><strong>authentication of the resource owner</strong> - purple arrows on the diagram below</li>
<li><strong>getting access token</strong> - blue arrows</li>
</ul>
<p><img alt="OAuth2 diagram" src="https://res.cloudinary.com/hpiynhbhq/image/upload/v1519172710/y4qjqs7xddhdvaf0j0r0.png" /></p>
<p>This process can be tricky, so let me explain each step:</p>
<ol>
<li><strong>Resource owner</strong> (via <strong>user-agent</strong>) opens a popup window which <strong>redirects</strong> him to the Firebase Cloud Function.</li>
<li>The Firebase Cloud Function <strong>redirects to SteemConnect endpoint</strong> with the client (application) information along with the scope of resources client wants to gain access to, and URI which SteemConnect will redirect to after success. At this point, the user is asked to give the third-party app access to the requested resources.</li>
<li>SteemConnect redirects to provided URI with <strong>code</strong> as a query parameter (for example, <code>http://localhost:4200/redirect?code=fdt453534fds</code>).</li>
<li><strong>User-agent</strong> on the resource owner behalf makes a <strong>request</strong> to the Firebase Cloud Function along with the <strong>code</strong>.</li>
<li>Firebase Cloud Function <strong>makes a request to SteemConnect token endpoint</strong> with client information and the code.</li>
<li><strong>SteemConnect responses with an access token</strong> and some additional info such as the resource owner username.</li>
<li>Based on the username <strong>Firebase mints a custom auth token</strong> and sends it back to the resource owner. This step is not really OAuth2 related, but important for the Firebase Authentication system.</li>
</ol>
<p>Don't worry if you don't understand everything yet. It will become clear when we actually implement these steps in our app.</p>
<h2 id="creating-firebase-project">Creating Firebase project</h2>
<p>The <a href="https://sc-firebase-functions-example.firebaseapp.com/">app</a> we are going to create is gonna use <strong>Firebase Authentication</strong>, <strong>Firebase Cloud Functions</strong> and <strong>Firebase Cloud Firestore</strong>... so we have to create Firebase project.</p>
<p>This process is really simple, one just has to go to the <a href="https://console.firebase.google.com/u/0/">Firebase Console</a> and click <em>Add project</em>. You will see a modal, where you choose your project name and your country. The last step for now is to click <em>Create project</em> and wait a few seconds.</p>
<p>That's all for now, but we will come back here a few times later.</p>
<h2 id="creating-steemconnect-project">Creating SteemConnect project</h2>
<p>Creating SteemConnect project is nothing fancy once again. To do so, one simply has to go to https://steemconnect.com/dashboard and navigate to <em>My apps</em> and click <em>New app</em>.</p>
<p><strong>Warning</strong>: the username for your app you choose at this point is not changeable! So make sure you typed it correctly before clicking <em>Create account</em>.</p>
<p>In the next step, fill the form as you wish, but make sure to add <code>http://localhost:4200/redirect</code> to <em>Redirect URI(s)</em> section:</p>
<p><img alt="SteemConnect project" src="https://res.cloudinary.com/hpiynhbhq/image/upload/v1519137017/hi4plxsgi4sfyvgkdadi.png" /></p>
<p>We will come back to the dashboard later for <strong>client id</strong> and <strong>client secret</strong>.</p>
<h2 id="creating-angular-project">Creating Angular project</h2>
<p>Although we won't write any code for the frontend yet, creating an Angular project using Angular CLI is always a good start. Let's do it then!</p>
<div class="codehilite"><pre><span></span>ng new your-project-name
cd your-project-name
</pre></div>


<h2 id="backend">Backend</h2>
<p>The backend we are going to create is, of course, based on Firebase Cloud Functions. However, before we start coding, we have to install <code>firebase-tools</code>:</p>
<div class="codehilite"><pre><span></span>npm install firebase-tools -g
</pre></div>


<p>Once installed, initialize Firebase Cloud Functions project:</p>
<div class="codehilite"><pre><span></span>firebase init functions
</pre></div>


<p>During this process you will be asked for a default project for this directory, select project which you have created in the <strong>Creating Firebase project</strong> section. Later, when asked <em>What language would you like to use to write Cloud Functions</em>, pick <strong>TypeScript</strong>. Also, you <strong>want</strong> to both <em>use TSLint to catch probable bugs and enforce style</em> and <em>install dependencies with npm now</em>.</p>
<p>Our backend code is now in the <em>functions</em> directory, let's move there:</p>
<div class="codehilite"><pre><span></span>cd functions
</pre></div>


<p>We will need some dependencies, first of all <a href="https://www.npmjs.com/package/steemconnect-firebase-functions"><strong>steemconnect-firebase-functions</strong></a>:</p>
<div class="codehilite"><pre><span></span>npm install steemconnect-firebase-functions --save
</pre></div>


<p>and <a href="https://www.npmjs.com/package/cors">CORS</a>:</p>
<div class="codehilite"><pre><span></span>npm install cors --save
npm install @types/cors --save-dev
</pre></div>


<p>Next, go back to <a href="https://console.firebase.google.com/u/0/">Firebase Console</a>. We are going to mint Custom Firebase Auth Tokens, so we need service account credentials:</p>
<p><img alt="service account 1" src="https://res.cloudinary.com/hpiynhbhq/image/upload/v1519157795/rkhb55hasz0scz4dgu87.png" /></p>
<p>and then click <em>GENERATE NEW PRIVATE KEY</em>.</p>
<p><img alt="service account 2" src="https://res.cloudinary.com/hpiynhbhq/image/upload/v1519157964/bjzarw6nawogriqsubpr.png" /></p>
<p>Move downloaded file to our backend root folder (<em>functions</em>) and rename it to <em>serviceAccountKey.json</em>. Also, make sure you <strong>don't expose it</strong> (add this file to .gitignore etc.).</p>
<p>Once done, open your favorite code editor and paste the code below to <em>src/index.ts</em>:</p>
<div class="codehilite"><pre><span></span><span class="c1">// IMPORTS</span>

<span class="kr">import</span> <span class="p">{</span>
  <span class="nx">getAuthorizationUrl</span><span class="p">,</span>
  <span class="nx">getAccessToken</span><span class="p">,</span>
  <span class="nx">mintFirebaseToken</span><span class="p">,</span>
  <span class="nx">Scope</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;steemconnect-firebase-functions&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">functions</span> <span class="nx">from</span> <span class="s1">&#39;firebase-functions&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">admin</span> <span class="nx">from</span> <span class="s1">&#39;firebase-admin&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">CORS</span> <span class="nx">from</span> <span class="s1">&#39;cors&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">serviceAccount</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../serviceAccountKey.json&#39;</span><span class="p">);</span>

<span class="c1">// CONFIGURATION</span>

<span class="kr">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">CORS</span><span class="p">({</span> <span class="nx">origin</span>: <span class="kt">true</span> <span class="p">});</span>

<span class="nx">admin</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">({</span>
  <span class="nx">credential</span>: <span class="kt">admin.credential.cert</span><span class="p">(</span><span class="nx">serviceAccount</span><span class="p">)</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">redirectUri</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:4200/redirect&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">scope</span>: <span class="kt">Array</span><span class="o">&lt;</span><span class="nx">Scope</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">];</span>

<span class="kr">const</span> <span class="nx">clientId</span> <span class="o">=</span> <span class="s1">&#39;YOUR_CLIENT_ID&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">clientSecret</span> <span class="o">=</span> <span class="s1">&#39;YOUR_CLIENT_SECRET&#39;</span><span class="p">;</span>

<span class="c1">// FUNCTIONS</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">redirect</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="nx">getAuthorizationUrl</span><span class="p">({</span> <span class="nx">clientId</span><span class="p">,</span> <span class="nx">redirectUri</span><span class="p">,</span> <span class="nx">scope</span> <span class="p">});</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">);</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">cors</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">handleCallback</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">token</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="nx">token</span> <span class="p">}))</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// HELPER FUNCTION</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">handleCallback</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span><span class="p">;</span>

  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getAccessToken</span><span class="p">({</span>
    <span class="nx">clientId</span><span class="p">,</span>
    <span class="nx">clientSecret</span><span class="p">,</span>
    <span class="nx">redirectUri</span><span class="p">,</span>
    <span class="nx">code</span>
  <span class="p">});</span>
  <span class="kr">const</span> <span class="nx">uid</span> <span class="o">=</span> <span class="sb">`steemconnect:</span><span class="si">${</span><span class="nx">accessToken</span><span class="p">.</span><span class="nx">username</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

  <span class="kr">const</span> <span class="nx">firebaseToken</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">mintFirebaseToken</span><span class="p">(</span><span class="nx">admin</span><span class="p">,</span> <span class="nx">uid</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">firebaseToken</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>What's going on there?</p>
<h4 id="imports">Imports</h4>
<p>Nothing fancy there, we are just importing modules we will need later in this file. The worth to mention is fact that we import <strong>only three functions</strong> from <strong>steemconnect-firebase-functions</strong>, but <strong>there are more of them</strong>, and <strong>will be even more</strong> ;)</p>
<p>We just don't need more for this app - we will only identify user identity and then mint custom auth token based on his username.</p>
<h4 id="configuration">Configuration</h4>
<p>In this section you have to paste your own <code>clientId</code> and <code>clientSecret</code>. To get them, go back to <a href="https://steemconnect.com/dashboard">SteemConnect dashboard</a>, then go to <em>My apps</em> and click on your app name. There you have both of these values.</p>
<p>Also, make sure you don't expose this file - <strong>client secret is a sensitive value</strong>! We paste them as they are only for the purpose of local running. If you decide to deploy your app you will have another way to insert them into your code. More information in the last section of this post.</p>
<h4 id="functions">Functions</h4>
<p>This is the part of the file where magic happens. We have defined two Cloud Functions - <strong>redirect</strong> and <strong>callback</strong>. Both react to any <strong>http requests</strong>. It means that each time we make a request or simply navigate to URL dedicated to each function, the code inside it is gonna run.</p>
<p>The <strong>redirect</strong> function is responsible for handling the <strong>step 2</strong> of OAuth2 Authorization Code Grant (see diagram above). It uses <code>getAuthorizationUrl</code> function from <strong>steemconnect-firebase-functions</strong> library.</p>
<p>On the other hand, the <strong>callback</strong> function doesn't handle just one step. It actually handles two - <strong>step 5 and 7</strong>. To do so, it uses a helper async function <strong>handleCallback</strong>.</p>
<h4 id="helper-function">Helper function</h4>
<p>The <strong>handleCallback</strong> async function uses two functions from <strong>steemconnect-firebase-functions</strong> library - <code>getAccessToken</code> (<strong>step 5</strong>) and <code>mintFirebaseToken</code> (<strong>step 7</strong>).</p>
<p>It's quite obvious what they do, but fortunately you don't have to worry how to implement functionality they provide. Cool, isn't it?</p>
<p>Also, at this point, you have an access to <strong>access token</strong>. Based on the scope, access token enables client to do different operations on the behalf of the user.</p>
<p>So, in this helper function, we also could save this token in the Cloud Firestore for a later use - <code>saveAccessToken</code> function from <strong>steemconnect-firebase-functions</strong> would do the job, but make sure to <strong>deny access to each document of the <em>steemconnectToken</em> collection</strong> later with the Firestore security rules! More about them in a separate section and in the references.</p>
<p>We could also get more user details than just a username using the <code>getUserData</code> function, again from my library.</p>
<p>Broadcasting operations to the blockchain isn't anything fancy too - as we have access token at this point (remember it requires different scope than <em>login</em>) we could use the <code>broadcastOperations</code> function.</p>
<h3 id="running-functions-locally">Running functions locally</h3>
<p>We have almost everything set up to run our backend locally. There are actually two more commands you have to run in the backend root folder:</p>
<div class="codehilite"><pre><span></span>npm run build
</pre></div>


<p>and then:</p>
<div class="codehilite"><pre><span></span>firebase serve --only functions
</pre></div>


<p>Keep them running, because we will need them in the frontend app, which we are going to start building right now.</p>
<h2 id="frontend">Frontend</h2>
<p>Our frontend application has two important roles in the OAuth2 flow - handle <strong>step 1</strong> and <strong>step 4</strong>. In addition, it has to make use of the token that <strong>callback</strong> Cloud Function responses with if minting custom auth token succeed. Quite a lot of work to do, so let's start!</p>
<p>If you are in the <em>functions</em> directory, go back to Angular project:</p>
<div class="codehilite"><pre><span></span>cd ../
</pre></div>


<p>but make sure functions are still running!</p>
<p>The first step in building Firebase frontend in Angular is usually configuring <a href="https://github.com/angular/angularfire2">AngularFire2</a>:</p>
<div class="codehilite"><pre><span></span>npm install angularfire2 firebase --save
</pre></div>


<p>once installed, go back to <a href="https://console.firebase.google.com/u/0/">Firebase Console</a>, choose your project and click <em>Add Firebase to your web app</em>. Copy all properties of config object and paste them inside <em>src/environments/environment.ts</em> file like that:</p>
<div class="codehilite"><pre><span></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">environment</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">production</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">firebaseConfig</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">apiKey</span><span class="o">:</span> <span class="s1">&#39;&lt;your-key&gt;&#39;</span><span class="p">,</span>
    <span class="nx">authDomain</span><span class="o">:</span> <span class="s1">&#39;&lt;your-project-authdomain&gt;&#39;</span><span class="p">,</span>
    <span class="nx">databaseURL</span><span class="o">:</span> <span class="s1">&#39;&lt;your-database-URL&gt;&#39;</span><span class="p">,</span>
    <span class="nx">projectId</span><span class="o">:</span> <span class="s1">&#39;&lt;your-project-id&gt;&#39;</span><span class="p">,</span>
    <span class="nx">storageBucket</span><span class="o">:</span> <span class="s1">&#39;&lt;your-storage-bucket&gt;&#39;</span><span class="p">,</span>
    <span class="nx">messagingSenderId</span><span class="o">:</span> <span class="s1">&#39;&lt;your-messaging-sender-id&gt;&#39;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>We also have to import a few AngularFire2 modules. Our AppModule should look like that for now:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-browser&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireAuthModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/auth&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFirestoreModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/firestore&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AppComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app.component&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../environments/environment&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">AngularFireModule</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">(</span><span class="nx">environment</span><span class="p">.</span><span class="nx">firebaseConfig</span><span class="p">),</span>
    <span class="nx">AngularFireAuthModule</span><span class="p">,</span>
    <span class="nx">AngularFirestoreModule</span>
  <span class="p">],</span>
  <span class="nx">providers</span><span class="o">:</span> <span class="p">[],</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</pre></div>


<p>Next let's create an AuthService, which will handle most of the user authentication:</p>
<div class="codehilite"><pre><span></span>ng g s auth -m app
</pre></div>


<p>now fill <em>auth.service.ts</em> with the following code:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/Observable&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">switchMap</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireAuth</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/auth&#39;</span><span class="p">;</span>

<span class="kd">@Injectable</span><span class="p">()</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AuthService</span> <span class="p">{</span>
  <span class="nx">user</span>: <span class="kt">Observable</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">afAuth</span>: <span class="kt">AngularFireAuth</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">afAuth</span><span class="p">.</span><span class="nx">authState</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">login() {</span>
    <span class="kr">const</span> <span class="nx">popup</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span>
      <span class="s1">&#39;redirect_function_url&#39;</span><span class="p">,</span>
      <span class="s1">&#39;_blank&#39;</span><span class="p">,</span>
      <span class="s1">&#39;height=700,width=800&#39;</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">signIn</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">afAuth</span><span class="p">.</span><span class="nx">auth</span>
      <span class="p">.</span><span class="nx">signInWithCustomToken</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="nx">signout() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">afAuth</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">signOut</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>and replace <code>redirect_function_url</code> in the <code>login</code> method with the actual URL to <strong>redirect Function</strong>.</p>
<p>Before we create components to complete our OAuth2 flow, let's ensure it will look pretty. <a href="https://getbootstrap.com/">Bootstrap</a> seems like a good choice, let's add it to <em>src/index.html</em>:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>SteemconnectFirebaseFunctionsExample<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">base</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;icon&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;image/x-icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;favicon.ico&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm&quot;</span>
    <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">app-root</span><span class="p">&gt;&lt;/</span><span class="nt">app-root</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>At this point, we need two more components - <strong>RedirectComponent</strong> and <strong>UserDetailsComponent</strong>. The first one will handle the <strong>step 4</strong> and the second one will be responsible to provide the functionality of <strong>step 1</strong>.</p>
<p><strong>RedirectComponent</strong> will be created each time user hit the <code>http://localhost:4200/redirect</code> URL. To be more precise - user won't navigate there, but SteemConnect will redirect there after successful login with the <strong>code</strong> as a query parameter, and the job of RedirectComponent will be to deliver this code to <strong>callback</strong> Cloud Function and make a use of its response - custom auth token.</p>
<p>On the other hand, <strong>UserDetailsComponent</strong> will display a <em>Login with SteemConnect</em> button for not logged in users, and <strong>uid</strong> along with <em>Signout</em> button for logged in users.</p>
<p>Let's generate them:</p>
<div class="codehilite"><pre><span></span>ng g c redirect
ng g c user-details
</pre></div>


<p>The <em>redirect.component.ts</em> should look like that:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpClient</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span><span class="p">,</span> <span class="nx">ActivatedRoute</span><span class="p">,</span> <span class="nx">Params</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">switchMap</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">fromPromise</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/observable/fromPromise&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../auth.service&#39;</span><span class="p">;</span>

<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-redirect&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./redirect.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./redirect.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">RedirectComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="kr">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">http</span>: <span class="kt">HttpClient</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">route</span>: <span class="kt">ActivatedRoute</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">auth</span>: <span class="kt">AuthService</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">ngOnInit() {</span>
    <span class="kr">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">.</span><span class="nx">queryParamMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`&lt;CALLBACK-FUNCTION-URL&gt;/callback?code=</span><span class="si">${</span><span class="nx">code</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">http</span>
        <span class="p">.</span><span class="nx">post</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
          <span class="nx">switchMap</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fromPromise</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">signIn</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">token</span><span class="p">));</span>
          <span class="p">})</span>
        <span class="p">)</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Make sure to replace <code>&lt;CALLBACK-FUNCTION-URL&gt;</code> with the actual URL of the <strong>callback</strong> Function.</p>
<p>Both <em>redirect.component.html</em> and <em>redirect.component.css</em> are not that important, because this component will be displayed only for short period of time, so you can leave it as it is, change text in the HTML to something like <em>Loading...</em>, or even make a fancy loading spinner on your own :)</p>
<p>Now let's move to <strong>UserDetailsComponent</strong>; <em>user-details.component.ts</em> is simple:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../auth.service&#39;</span><span class="p">;</span>

<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-user-details&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./user-details.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./user-details.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">UserDetailsComponent</span> <span class="p">{</span>
  <span class="kr">constructor</span><span class="p">(</span><span class="kr">public</span> <span class="nx">auth</span>: <span class="kt">AuthService</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>


<p>the entire magic happens in its template <em>user-details.component.html</em>:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;auth.user | async as user; else guest&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title&quot;</span><span class="p">&gt;</span>Hello!<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h6</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-subtitle mb-2 text-muted&quot;</span><span class="p">&gt;</span>You are logged into Firebase via SteemConnect!<span class="p">&lt;/</span><span class="nt">h6</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-text&quot;</span><span class="p">&gt;</span>That&#39;s your uid:
        <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>{{ user.uid }}<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&quot;</span><span class="na">auth</span><span class="err">.</span><span class="na">signout</span><span class="err">()&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-warning&quot;</span><span class="p">&gt;</span>Signout<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ng-template</span> <span class="err">#</span><span class="na">guest</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&quot;</span><span class="na">auth</span><span class="err">.</span><span class="na">login</span><span class="err">()&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="p">&gt;</span>Login with SteemConnect!<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ng-template</span><span class="p">&gt;</span>
</pre></div>


<p>To make signing in feature work, we need to do one more thing - set up routing. Let's start with the <em>app.component.html</em>, where <code>router-outlet</code> is gonna be placed:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-light bg-light&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>steemconnect-firebase-functions<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item nav-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://github.com/jakipatryk/steemconnect-firebase-functions-example&quot;</span><span class="p">&gt;</span>Github<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xs-12 col-md-4&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-outlet</span><span class="p">&gt;&lt;/</span><span class="nt">router-outlet</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xs-12 col-md-8&quot;</span><span class="p">&gt;</span>
      We will add messages here later on.
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>


<p>The last step for now is configuration of routes in <em>app.module.ts</em>, this file should look like following for now:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-browser&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Routes</span><span class="p">,</span> <span class="nx">RouterModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpClientModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireAuthModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/auth&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFirestoreModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/firestore&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AppComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">RedirectComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./redirect/redirect.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">UserDetailsComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./user-details/user-details.component&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./auth.service&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../environments/environment&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">routes</span>: <span class="kt">Routes</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">component</span>: <span class="kt">UserDetailsComponent</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;redirect&#39;</span><span class="p">,</span> <span class="nx">component</span>: <span class="kt">RedirectComponent</span> <span class="p">}</span>
<span class="p">];</span>

<span class="kd">@NgModule</span><span class="p">({</span>
  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">,</span> <span class="nx">RedirectComponent</span><span class="p">,</span> <span class="nx">UserDetailsComponent</span><span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">),</span>
    <span class="nx">HttpClientModule</span><span class="p">,</span>
    <span class="nx">AngularFireModule</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">(</span><span class="nx">environment</span><span class="p">.</span><span class="nx">firebaseConfig</span><span class="p">),</span>
    <span class="nx">AngularFireAuthModule</span><span class="p">,</span>
    <span class="nx">AngularFirestoreModule</span>
  <span class="p">],</span>
  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span><span class="nx">AuthService</span><span class="p">],</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</pre></div>


<p>Aaaand... we have implemented the entire OAuth2 Authorization Code Grant and the signing in with the Firebase custom auth token! Don't you believe? Ok, let's test it then!</p>
<div class="codehilite"><pre><span></span>ng serve
</pre></div>


<p>now just open up your browser and navigate to <code>http://localhost:4200</code>, that's what you are gonna see after successful sign in:</p>
<p><img alt="OAuth2 completed" src="https://res.cloudinary.com/hpiynhbhq/image/upload/v1519227526/zoricn9g0mthlyu0pqyb.png" /></p>
<p>also, the <em>Authentication</em> page in the Firebase Console has changed ;)</p>
<p><img alt="Firebase Console Authentication" src="https://res.cloudinary.com/hpiynhbhq/image/upload/v1519227586/agedzxfqgsea3hnnhskd.png" /></p>
<p>I could have ended this tutorial here, but I want to show a really trivial example of what you can do now. Even though it is not gonna be complex, you will see that from this point making Steem-related apps that doesn't add anything to the blockchain is easy. Do you wonder why would anyone create an Steem-related app that don't publish anything to the blockchain? Check <a href="https://steemprojects.com/">SteemProjects</a> by @noisy.</p>
<h3 id="messages">Messages</h3>
<p>In this section we will add messages that any logged in user would be able to add. At the end our app will look like the <a href="https://sc-firebase-functions-example.firebaseapp.com/">example app</a>.</p>
<p>Before we move to the code, you have to turn on Cloud Firestore. To do so, simply go to the <a href="https://console.firebase.google.com/u/0/">Firebase Console</a>, choose your project, go to <em>Database</em> page and click <em>TRY FIRESTORE BETA</em> (select <em>Start in test mode</em> when asked).</p>
<p>Let's start with generating two presentational components - <strong>MessageDetailsComponent</strong> and <strong>MessageFormComponent</strong>, one container component - <strong>MessageListComponent</strong>, a service to handle data flow between the Angular app and the Firestore - <strong>MessageService</strong> and the interface of <strong>Message</strong>:</p>
<div class="codehilite"><pre><span></span>ng g c messages/message-details
ng g c messages/message-form
ng g c messages/message-list
ng g s messages/message -m app
ng g i messages/models/message
</pre></div>


<p>Our <strong>Message</strong> interface should look like that:</p>
<div class="codehilite"><pre><span></span><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Message</span> <span class="p">{</span>
  <span class="nx">author</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">text</span>: <span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Now let's bring some life to our presentational components starting with <strong>MessageFormComponent</strong>. This kind of component shouldn't be aware of any data, so in <em>message-form.component.ts</em> we should use <code>@Output</code> decorator and <code>EventEmmiter</code> to emit values of our reactive form once submited:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">EventEmitter</span><span class="p">,</span> <span class="nx">Output</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">FormGroup</span><span class="p">,</span> <span class="nx">Validators</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">Message</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../models/message&#39;</span><span class="p">;</span>

<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-message-form&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./message-form.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./message-form.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">MessageFormComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="kd">@Output</span><span class="p">()</span> <span class="nx">messageEmitter</span>: <span class="kt">EventEmitter</span><span class="o">&lt;</span><span class="nx">Message</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="nx">Message</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="nx">messageForm</span>: <span class="kt">FormGroup</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">formBuilder</span>: <span class="kt">FormBuilder</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">ngOnInit() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createMessageForm</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">addMessage() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messageEmitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">({</span>
      <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">messageForm</span><span class="p">.</span><span class="nx">value</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">createMessageForm() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messageForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">formBuilder</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
      <span class="nx">text</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>the template of this component is nothing fancy, just a simple form:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&quot;</span><span class="na">messageForm</span><span class="err">&quot;</span> <span class="err">(</span><span class="na">ngSubmit</span><span class="err">)=&quot;</span><span class="na">addMessage</span><span class="err">()&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;textInput&quot;</span><span class="p">&gt;</span>Your message:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;textInput&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">aria-describedby</span><span class="o">=</span><span class="s">&quot;textHelper&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">small</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;textHelper&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-text text-muted&quot;</span><span class="p">&gt;</span>It&#39;s NOT gonna be published on the Steem blockchain.<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="p">&gt;</span>Submit<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>


<p>The second presentational component is going to be responsible to display the details of a message (text, author); <em>message-details.component.ts</em>:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Input</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Message</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../models/message&#39;</span><span class="p">;</span>

<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-message-details&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./message-details.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./message-details.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">MessageDetailsComponent</span> <span class="p">{</span>
  <span class="kd">@Input</span><span class="p">()</span> <span class="nx">message</span>: <span class="kt">Message</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>and <em>message-details.component.html</em>:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-title mb-2 text-muted&quot;</span><span class="p">&gt;</span>{{ message.author | uidToUsername }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-text&quot;</span><span class="p">&gt;</span>{{ message.text }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>


<p>As you can see, we use <code>uidToUsername</code> pipe, which is a custom pipe, so we have to generate it:</p>
<div class="codehilite"><pre><span></span>ng g p messages/pipes/uid-to-username
</pre></div>


<p>It transforms uid to username, for example <strong>steemconnect:jakipatryk</strong> to <strong>jakipatryk</strong>:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Pipe</span><span class="p">,</span> <span class="nx">PipeTransform</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kd">@Pipe</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;uidToUsername&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">UidToUsernamePipe</span> <span class="kr">implements</span> <span class="nx">PipeTransform</span> <span class="p">{</span>
  <span class="nx">transform</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">args?</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;steemconnect:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">username</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>We are almost ready to power up our presentational components with data. Yes, almost. We have to complete two more tasks. Updating <strong>MessageService</strong> is a perfect choice now:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span>
  <span class="nx">AngularFirestore</span><span class="p">,</span>
  <span class="nx">AngularFirestoreDocument</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/firestore&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/Observable&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">Message</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./models/message&#39;</span><span class="p">;</span>

<span class="kd">@Injectable</span><span class="p">()</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">MessageService</span> <span class="p">{</span>
  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">afs</span>: <span class="kt">AngularFirestore</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">addMessage</span><span class="p">(</span><span class="nx">data</span>: <span class="kt">Message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">afs</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">).</span><span class="nx">add</span><span class="p">({</span> <span class="p">...</span><span class="nx">data</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">getMessages</span><span class="p">()</span><span class="o">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">Message</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">afs</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">).</span><span class="nx">valueChanges</span><span class="p">()</span> <span class="kr">as</span> <span class="nx">Observable</span><span class="o">&lt;</span>
      <span class="nx">Message</span><span class="p">[]</span>
    <span class="o">&gt;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Now we can use it in our container component - <strong>MessageListComponent</strong>:</p>
<p><em>message-list.component.ts</em>:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">MessageService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../message.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../auth.service&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">Message</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../models/message&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/Observable&#39;</span><span class="p">;</span>

<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-message-list&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./message-list.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./message-list.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">MessageListComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="nx">currentUser</span><span class="p">;</span>
  <span class="nx">messages</span>: <span class="kt">Observable</span><span class="o">&lt;</span><span class="nx">Message</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">messageService</span>: <span class="kt">MessageService</span><span class="p">,</span>
    <span class="kr">public</span> <span class="nx">auth</span>: <span class="kt">AuthService</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">ngOnInit() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">getMessages</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">addMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">dataWithAuthor</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">data</span><span class="p">,</span> <span class="nx">author</span>: <span class="kt">this.currentUser.uid</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">dataWithAuthor</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><em>message-list.component.html</em>:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;auth.user | async as user&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">app-message-form</span> <span class="err">(</span><span class="na">messageEmitter</span><span class="err">)=&quot;</span><span class="na">addMessage</span><span class="err">($</span><span class="na">event</span><span class="err">)&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">app-message-form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


<span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;!(messages | async)&quot;</span><span class="p">&gt;</span>
  Loading messages...
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">app-message-details</span> <span class="err">*</span><span class="na">ngFor</span><span class="o">=</span><span class="s">&quot;let message of messages | async&quot;</span> <span class="err">[</span><span class="na">message</span><span class="err">]=&quot;</span><span class="na">message</span><span class="err">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">app-message-details</span><span class="p">&gt;</span>
</pre></div>


<p>We are almost done. Let's now add our container component to <strong>AppComponent</strong>, its template should have the following code:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-light bg-light&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>steemconnect-firebase-functions<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item nav-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://github.com/jakipatryk/steemconnect-firebase-functions-example&quot;</span><span class="p">&gt;</span>Github<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xs-12 col-md-4&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-outlet</span><span class="p">&gt;&lt;/</span><span class="nt">router-outlet</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xs-12 col-md-8&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">app-message-list</span><span class="p">&gt;&lt;/</span><span class="nt">app-message-list</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>


<p>The last step is to make sure we have included everything in the <strong>AppModule</strong>:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-browser&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpClientModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Routes</span><span class="p">,</span> <span class="nx">RouterModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ReactiveFormsModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFireAuthModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/auth&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AngularFirestoreModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;angularfire2/firestore&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AppComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">RedirectComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./redirect/redirect.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">UserDetailsComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./user-details/user-details.component&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./auth.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">MessageService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./messages/message.service&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../environments/environment&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">MessageListComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./messages/message-list/message-list.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">MessageDetailsComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./messages/message-details/message-details.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">MessageFormComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./messages/message-form/message-form.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">UidToUsernamePipe</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./messages/uid-to-username.pipe&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">routes</span>: <span class="kt">Routes</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">component</span>: <span class="kt">UserDetailsComponent</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;redirect&#39;</span><span class="p">,</span> <span class="nx">component</span>: <span class="kt">RedirectComponent</span> <span class="p">}</span>
<span class="p">];</span>

<span class="kd">@NgModule</span><span class="p">({</span>
  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">AppComponent</span><span class="p">,</span>
    <span class="nx">RedirectComponent</span><span class="p">,</span>
    <span class="nx">UserDetailsComponent</span><span class="p">,</span>
    <span class="nx">MessageListComponent</span><span class="p">,</span>
    <span class="nx">MessageDetailsComponent</span><span class="p">,</span>
    <span class="nx">MessageFormComponent</span><span class="p">,</span>
    <span class="nx">UidToUsernamePipe</span>
  <span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">),</span>
    <span class="nx">HttpClientModule</span><span class="p">,</span>
    <span class="nx">ReactiveFormsModule</span><span class="p">,</span>
    <span class="nx">AngularFireModule</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">(</span><span class="nx">environment</span><span class="p">.</span><span class="nx">firebaseConfig</span><span class="p">),</span>
    <span class="nx">AngularFireAuthModule</span><span class="p">,</span>
    <span class="nx">AngularFirestoreModule</span>
  <span class="p">],</span>
  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span><span class="nx">AuthService</span><span class="p">,</span> <span class="nx">MessageService</span><span class="p">],</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</pre></div>


<p><strong>Now simply <code>ng serve</code> the app and enjoy your first Firebase and SteemConnect based application!</strong></p>
<p><img alt="Final app" src="https://res.cloudinary.com/hpiynhbhq/image/upload/v1519239977/ym7exspagi3a1zutlnua.jpg" /></p>
<h2 id="backend-once-again-security">Backend once again (security)</h2>
<p>We do already have a working app. Cool, but you might remember that you started the database in the <strong>test mode</strong>. While it is ok to use it during the development phase, it is completely wrong to use this mode on the production.</p>
<p>Why? Test mode allows anyone to read, create, update and delete any data in the Firestore. We don't want that.</p>
<p>We want to allow:</p>
<ul>
<li><strong>anyone to read</strong> messages</li>
<li><strong>logged in users to create</strong> messages</li>
<li><strong>authors to update or delete</strong> their messages</li>
</ul>
<p>To achieve this, one has to visit <a href="https://console.firebase.google.com/u/0/">Firebase console</a> once again, navigate to the project and then to <em>Database</em> page. Here, in the <em>RULES</em> section, we define our rules.</p>
<p>In case of our app, the rules should be following:</p>
<div class="codehilite"><pre><span></span><span class="nt">service</span> <span class="nt">cloud</span><span class="p">.</span><span class="nc">firestore</span> <span class="p">{</span>
  <span class="err">match</span> <span class="err">/databases/{database</span><span class="p">}</span><span class="o">/</span><span class="nt">documents</span> <span class="p">{</span>
    <span class="err">match</span> <span class="err">/messages/{message</span><span class="p">}</span> <span class="p">{</span>
      <span class="err">allow</span> <span class="n">read</span><span class="p">:</span> <span class="n">if</span> <span class="n">true</span><span class="p">;</span>
      <span class="err">allow</span> <span class="err">update,</span> <span class="n">delete</span><span class="p">:</span> <span class="n">if</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="n">resource</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">author</span><span class="p">;</span>
      <span class="err">allow</span> <span class="n">create</span><span class="p">:</span> <span class="n">if</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">uid</span> <span class="o">!=</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="err">}</span>
<span class="err">}</span>
</pre></div>


<h2 id="deploying-the-app-and-cloud-functions">Deploying the app and Cloud Functions</h2>
<p><strong>NOTE</strong>: this section is for those who decided to choose <strong>paid pricing plan</strong> (Flame or Blaze).</p>
<p>Ok, we have everything set up. Now it's time for deployment. However, we have to do some configuration before we enter deploy command.</p>
<p>Let's start with the frontend. You might remember that we inserted the Firebase configuration in the <em>environment.ts</em> file. It worked well, but it won't work on the production. Angular CLI takes different file during the build for production - <em>environment.prod.ts</em>.</p>
<p>Basically, all you have to do is to copy <code>firebaseConfig</code> object from <em>environment.ts</em> to <em>environment.prod.ts</em>, but I highly recomment you create another Firebase project just for production. The setup process will be exactly the same as we did before.</p>
<p>Now let's move to backend Cloud Functions. We need to setup clientId and clientSecret as a Firebase variables, so in the terminal move to <em>functions</em> directory and type the following commands:</p>
<div class="codehilite"><pre><span></span>firebase functions:config:set steemconnect.id=&quot;YOUR_CLIENT_ID&quot; steemconnect.secret=&quot;YOUR_CLIENT_SECRET&quot;
</pre></div>


<p>Both <strong>id</strong> and <strong>secret</strong> are of course the same as before. Now let's change a bit our <em>index.ts</em> file, instead of:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">clientId</span> <span class="o">=</span> <span class="s1">&#39;YOUR_CLIENT_ID&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">clientSecret</span> <span class="o">=</span> <span class="s1">&#39;YOUR_CLIENT_SECRET&#39;</span><span class="p">;</span>
</pre></div>


<p>use:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">clientId</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">config</span><span class="p">().</span><span class="nx">steemconnect</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">clientSecret</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">config</span><span class="p">().</span><span class="nx">steemconnect</span><span class="p">.</span><span class="nx">secret</span><span class="p">;</span>
</pre></div>


<p>We also have to change the <code>redirectUri</code>. To do so, you have to go to <a href="https://console.firebase.google.com/u/0/">Firebase console</a> once again and then to your project. This time hit the <em>Hosting</em> page, click <em>GET STARTED</em>, then <em>CONTINUE</em> and finally <em>FINISH</em>. Copy the <strong>domain</strong> and update <code>redirectUri</code>:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">redirectUri</span> <span class="o">=</span> <span class="s1">&#39;https://&lt;YOUR-DOMAIN&gt;/redirect&#39;</span><span class="p">;</span>
</pre></div>


<p>Remember to add this redirectUri to the <em>Redirect URI(s)</em> at the <strong>SteemConnect dashboard!</strong></p>
<p>Now we can deploy our Cloud Functions!</p>
<div class="codehilite"><pre><span></span>firebase deploy --only functions
</pre></div>


<p>If you are getting an error here, try changing <em>firebase.json</em> file from:</p>
<div class="codehilite"><pre><span></span>{
  &quot;functions&quot;: {
    &quot;predeploy&quot;: [
      &quot;npm --prefix $RESOURCE_DIR run lint&quot;,
      &quot;npm --prefix $RESOURCE_DIR run build&quot;
    ]
  }
}
</pre></div>


<p>to:</p>
<div class="codehilite"><pre><span></span>{
  &quot;functions&quot;: {
    &quot;predeploy&quot;: [
      &quot;npm --prefix %RESOURCE_DIR% run lint&quot;,
      &quot;npm --prefix %RESOURCE_DIR% run build&quot;
    ]
  }
}
</pre></div>


<p>Once done, copy the URLs of the Cloud Functions and change the URLs in <em>auth.service.ts</em> and <em>redirect.component.ts</em>.</p>
<p>We could - and I would defienietly do so in a serious app - add additional property to environment files, something like <code>functionsURL</code> and add different URLs for production and development, so we could still test our functions and frontend locally. Then we could simply import <code>environment</code> file to both of these files and not change the URL directly, but use the environment variable <code>functionsURL</code> instead. Angular CLI would do its job then.</p>
<p>Anyway, whatever option you have chosen, the deployment of the Angular app will look exactly the same. First of all, we have to initialize the <strong>Firebase Hosting</strong>. To do so, move to the root folder of Angular app and type the command:</p>
<div class="codehilite"><pre><span></span>firebase init hosting
</pre></div>


<p>When asked:</p>
<ul>
<li><em>What do you want to use as your public directory?</em> - type <strong>dist</strong></li>
<li><em>Configure as a single-page app (rewrite all urls to /index.html)?</em> - type <strong>y</strong></li>
</ul>
<p>Once initialized, you have to build your app for production:</p>
<div class="codehilite"><pre><span></span>ng build --prod
</pre></div>


<p>The last step is to run:</p>
<div class="codehilite"><pre><span></span>firebase deploy --only hosting
</pre></div>


<p>Now you can enjoy your deployed app and Cloud Functions and share it with your friends!</p>
<h2 id="summary">Summary</h2>
<p>Huh, it's been a long tutorial. We have created an <a href="https://sc-firebase-functions-example.firebaseapp.com/">app</a> that implements <strong>OAuth2 Authorization Code Grant</strong> to enable users to authenticate via SteemConnect on the Firebase. To achieve this, we used <a href="https://github.com/jakipatryk/steemconnect-firebase-functions/"><strong>steemconnect-firebase-functions</strong></a> library, which I had created to make developer's life easier. On the frontend we used <strong>Angular</strong> + <strong>AngularFire2</strong> to build simple but powerful application.</p>
<h3 id="references">References</h3>
<ul>
<li><strong>OAuth2</strong>: <a href="https://tools.ietf.org/pdf/rfc6749.pdf">The OAuth 2.0 Authorization Framework</a></li>
<li><strong>SteemConnect</strong>: <a href="https://github.com/steemit/steemconnect/wiki/OAuth-2#scopes">available scopes</a></li>
<li><strong>Firebase Cloud Functions</strong>: <a href="https://firebase.google.com/docs/functions/">official docs</a></li>
<li><strong>Firebase Cloud Firestore</strong>: <a href="https://firebase.google.com/docs/firestore/">Firestore docs</a></li>
<li><strong>Firebase Cloud Firestore security rules</strong>: <a href="https://firebase.google.com/docs/firestore/security/overview?authuser=0">security rules docs</a></li>
<li><strong>AngularFire2</strong>: <a href="https://github.com/angular/angularfire2#angularfire">official docs</a></li>
<li><strong>User Agent</strong>: <a href="https://en.wikipedia.org/wiki/User_agent">Wikipedia</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../getting-started/" title="Getting Started" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </span>
            </div>
          </a>
        
        
          <a href="../broadcasting/" title="Broadcasting" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Broadcasting
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>